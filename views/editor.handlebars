{{#section 'head'}}
<link rel="canonical" href="/" />
<style type="text/css" media="screen">
    #editor {
        height:100vh;
        width: 50vw;
    }
    body{
        display: flex;
        flex-direction: row;

    }
</style>
{{/section}}
<div onChange="update()"id="editor">{{{initJson}}}</div>
<script src="/ace-builds-master/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/json");
    var debouncedUpdate = debounce(toUpdate, 1000);

    editor.getSession().on('change', function () {
        update()
    });

    function update() {;
        debouncedUpdate();
    }
    
    function toUpdate() {
        const value = editor.getSession().getValue();
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '/save', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(value);
        document.getElementById('previewIframe').contentWindow.location.reload();
    }

    function debounce(func, wait, immediate) {
            var timeout;
            return function () {
                var context = this, args = arguments;
                var later = function () {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        };
</script>


<iframe id="previewIframe" style="height:100vh; width: 50vw;" src="/preview/{{title}}"></iframe>